{"ast":null,"code":"import { forkJoin } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/covid-api.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"primeng/chart\";\nfunction ChartViewComponent_option_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 11);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", c_r1);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(c_r1);\n  }\n}\nexport class ChartViewComponent {\n  api;\n  countries = ['Ecuador', 'Peru', 'Colombia', 'Chile'];\n  selected = 'Ecuador';\n  covidLineData;\n  covidLineOptions;\n  pieData;\n  pieOptions;\n  donutData;\n  donutOptions;\n  loading = true;\n  constructor(api) {\n    this.api = api;\n  }\n  ngOnInit() {\n    this.fetch();\n  }\n  onCountryChange() {\n    this.fetch();\n  }\n  fetch() {\n    const country = this.selected;\n    this.loading = true;\n    forkJoin({\n      hist: this.api.getHistorical(country, 180),\n      sum: this.api.getCountry(country)\n    }).subscribe(({\n      hist,\n      sum\n    }) => {\n      // Línea: casos vs muertes\n      this.covidLineData = {\n        labels: hist.dates,\n        datasets: [{\n          label: 'Casos',\n          data: hist.cases,\n          fill: false,\n          tension: 0.25\n        }, {\n          label: 'Muertes',\n          data: hist.deaths,\n          fill: false,\n          tension: 0.25,\n          borderDash: [6, 6]\n        }]\n      };\n      this.covidLineOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n          legend: {\n            position: 'bottom'\n          },\n          tooltip: {\n            intersect: false,\n            mode: 'index'\n          }\n        },\n        scales: {\n          y: {\n            beginAtZero: true\n          }\n        }\n      };\n      // Pastel: casos vs recuperados vs fallecidos\n      this.pieData = {\n        labels: ['Casos', 'Recuperados', 'Fallecidos'],\n        datasets: [{\n          data: [sum?.cases ?? 0, sum?.recovered ?? 0, sum?.deaths ?? 0]\n        }]\n      };\n      this.pieOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n          legend: {\n            position: 'bottom'\n          },\n          tooltip: {\n            callbacks: {\n              label: ctx => {\n                const label = ctx.label ?? '';\n                const value = ctx.parsed ?? 0;\n                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);\n                const pct = total ? (value / total * 100).toFixed(1) : '0.0';\n                return `${label}: ${value.toLocaleString()} (${pct}%)`;\n              }\n            }\n          }\n        }\n      };\n      // Dona: activos vs recuperados vs fallecidos\n      const active = sum?.active ?? Math.max((sum?.cases ?? 0) - (sum?.recovered ?? 0) - (sum?.deaths ?? 0), 0);\n      this.donutData = {\n        labels: ['Activos', 'Recuperados', 'Fallecidos'],\n        datasets: [{\n          data: [active, sum?.recovered ?? 0, sum?.deaths ?? 0]\n        }]\n      };\n      this.donutOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        cutout: '60%',\n        plugins: {\n          legend: {\n            position: 'bottom'\n          }\n        }\n      };\n      this.loading = false;\n    }, _ => {\n      this.loading = false;\n    });\n  }\n  static ɵfac = function ChartViewComponent_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || ChartViewComponent)(i0.ɵɵdirectiveInject(i1.CovidApiService));\n  };\n  static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ChartViewComponent,\n    selectors: [[\"app-chart-view\"]],\n    decls: 23,\n    vars: 9,\n    consts: [[1, \"chart-view\"], [2, \"display\", \"flex\", \"gap\", \".5rem\", \"align-items\", \"center\", \"margin-bottom\", \".75rem\"], [\"for\", \"country\", 2, \"font-weight\", \"600\"], [\"name\", \"country\", \"id\", \"country\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"btn\", 3, \"click\", \"disabled\"], [1, \"cards\"], [1, \"card\"], [\"type\", \"line\", 2, \"height\", \"320px\", \"display\", \"block\", 3, \"data\", \"options\"], [\"type\", \"pie\", 2, \"height\", \"320px\", \"display\", \"block\", 3, \"data\", \"options\"], [\"type\", \"doughnut\", 2, \"height\", \"320px\", \"display\", \"block\", 3, \"data\", \"options\"], [3, \"value\"]],\n    template: function ChartViewComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"section\", 0)(1, \"h2\");\n        i0.ɵɵtext(2, \"Visor de Gr\\u00E1ficos\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(3, \"div\", 1)(4, \"label\", 2);\n        i0.ɵɵtext(5, \"Pa\\u00EDs:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"select\", 3);\n        i0.ɵɵtwoWayListener(\"ngModelChange\", function ChartViewComponent_Template_select_ngModelChange_6_listener($event) {\n          i0.ɵɵtwoWayBindingSet(ctx.selected, $event) || (ctx.selected = $event);\n          return $event;\n        });\n        i0.ɵɵlistener(\"change\", function ChartViewComponent_Template_select_change_6_listener() {\n          return ctx.onCountryChange();\n        });\n        i0.ɵɵtemplate(7, ChartViewComponent_option_7_Template, 2, 2, \"option\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(8, \"button\", 5);\n        i0.ɵɵlistener(\"click\", function ChartViewComponent_Template_button_click_8_listener() {\n          return ctx.onCountryChange();\n        });\n        i0.ɵɵtext(9, \"Actualizar\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(10, \"div\", 6)(11, \"div\", 7)(12, \"h3\");\n        i0.ɵɵtext(13, \"COVID-19 (l\\u00EDnea temporal)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(14, \"p-chart\", 8);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"div\", 7)(16, \"h3\");\n        i0.ɵɵtext(17, \"Distribuci\\u00F3n (casos, recuperados, fallecidos)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(18, \"p-chart\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(19, \"div\", 7)(20, \"h3\");\n        i0.ɵɵtext(21, \"Activos vs recuperados vs fallecidos\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(22, \"p-chart\", 10);\n        i0.ɵɵelementEnd()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵtwoWayProperty(\"ngModel\", ctx.selected);\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"ngForOf\", ctx.countries);\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"disabled\", ctx.loading);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"data\", ctx.covidLineData)(\"options\", ctx.covidLineOptions);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"data\", ctx.pieData)(\"options\", ctx.pieOptions);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"data\", ctx.donutData)(\"options\", ctx.donutOptions);\n      }\n    },\n    dependencies: [i2.NgForOf, i3.NgSelectOption, i3.ɵNgSelectMultipleOption, i3.SelectControlValueAccessor, i3.NgControlStatus, i3.NgModel, i4.UIChart],\n    styles: [\".chart-view[_ngcontent-%COMP%]{padding:1rem}.cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:1rem}.card[_ngcontent-%COMP%]{border:1px solid #e5e7eb;border-radius:12px;padding:1rem;background:#fff}.card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:.5rem}\"]\n  });\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}