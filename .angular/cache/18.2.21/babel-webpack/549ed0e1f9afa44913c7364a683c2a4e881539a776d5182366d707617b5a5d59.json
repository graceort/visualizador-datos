{"ast":null,"code":"import { forkJoin } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/covid-api.service\";\nimport * as i2 from \"primeng/chart\";\nexport class ChartViewComponent {\n  api;\n  countries = ['Ecuador', 'Peru', 'Colombia', 'Chile'];\n  selected = 'Ecuador';\n  covidLineData;\n  covidLineOptions;\n  pieData;\n  pieOptions;\n  donutData;\n  donutOptions;\n  loading = true;\n  constructor(api) {\n    this.api = api;\n  }\n  ngOnInit() {\n    this.fetch();\n  }\n  onCountryChange() {\n    this.fetch();\n  }\n  fetch() {\n    const country = this.selected;\n    this.loading = true;\n    forkJoin({\n      hist: this.api.getHistorical(country, 180),\n      sum: this.api.getCountry(country)\n    }).subscribe(({\n      hist,\n      sum\n    }) => {\n      // Línea: casos vs muertes\n      this.covidLineData = {\n        labels: hist.dates,\n        datasets: [{\n          label: 'Casos',\n          data: hist.cases,\n          fill: false,\n          tension: 0.25\n        }, {\n          label: 'Muertes',\n          data: hist.deaths,\n          fill: false,\n          tension: 0.25,\n          borderDash: [6, 6]\n        }]\n      };\n      this.covidLineOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n          legend: {\n            position: 'bottom'\n          },\n          tooltip: {\n            intersect: false,\n            mode: 'index'\n          }\n        },\n        scales: {\n          y: {\n            beginAtZero: true\n          }\n        }\n      };\n      // Pastel: casos vs recuperados vs fallecidos\n      this.pieData = {\n        labels: ['Casos', 'Recuperados', 'Fallecidos'],\n        datasets: [{\n          data: [sum?.cases ?? 0, sum?.recovered ?? 0, sum?.deaths ?? 0]\n        }]\n      };\n      this.pieOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        plugins: {\n          legend: {\n            position: 'bottom'\n          },\n          tooltip: {\n            callbacks: {\n              label: ctx => {\n                const label = ctx.label ?? '';\n                const value = ctx.parsed ?? 0;\n                const total = ctx.dataset.data.reduce((a, b) => a + b, 0);\n                const pct = total ? (value / total * 100).toFixed(1) : '0.0';\n                return `${label}: ${value.toLocaleString()} (${pct}%)`;\n              }\n            }\n          }\n        }\n      };\n      // Dona: activos vs recuperados vs fallecidos\n      const active = sum?.active ?? Math.max((sum?.cases ?? 0) - (sum?.recovered ?? 0) - (sum?.deaths ?? 0), 0);\n      this.donutData = {\n        labels: ['Activos', 'Recuperados', 'Fallecidos'],\n        datasets: [{\n          data: [active, sum?.recovered ?? 0, sum?.deaths ?? 0]\n        }]\n      };\n      this.donutOptions = {\n        responsive: true,\n        maintainAspectRatio: false,\n        cutout: '60%',\n        plugins: {\n          legend: {\n            position: 'bottom'\n          }\n        }\n      };\n      this.loading = false;\n    }, _ => {\n      this.loading = false;\n    });\n  }\n  static ɵfac = function ChartViewComponent_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || ChartViewComponent)(i0.ɵɵdirectiveInject(i1.CovidApiService));\n  };\n  static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ChartViewComponent,\n    selectors: [[\"app-chart-view\"]],\n    decls: 9,\n    vars: 4,\n    consts: [[1, \"chart-wrapper\"], [1, \"chart-card\"], [\"type\", \"bar\", 2, \"height\", \"360px\", \"display\", \"block\", 3, \"data\", \"options\"], [\"type\", \"line\", 2, \"height\", \"360px\", \"display\", \"block\", 3, \"data\", \"options\"]],\n    template: function ChartViewComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"section\", 1)(2, \"h3\");\n        i0.ɵɵtext(3, \"Estados por Mes (Barras apiladas)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(4, \"p-chart\", 2);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"section\", 1)(6, \"h3\");\n        i0.ɵɵtext(7, \"Tendencia diaria (L\\u00EDnea)\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(8, \"p-chart\", 3);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"data\", ctx.stackedData)(\"options\", ctx.stackedOptions);\n        i0.ɵɵadvance(4);\n        i0.ɵɵproperty(\"data\", ctx.lineData)(\"options\", ctx.lineOptions);\n      }\n    },\n    dependencies: [i2.UIChart],\n    styles: [\".chart-wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:1.5rem;padding:1rem}@media (min-width: 900px){.chart-wrapper[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr}}.chart-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;padding:1rem 1.25rem;box-shadow:0 8px 24px #0000000f}.chart-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:.25rem 0 1rem;font-weight:600;color:#1a237e}\"]\n  });\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}